name: Post-Merge Production Verification

on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

env:
  PROD_URL: https://zeropointprotocol.ai
  NODE_VERSION: '20'

jobs:
  probes:
    runs-on: ubuntu-latest
    steps:
      - name: Verify production endpoints
        run: |
          set -e
          curl -sS -D - https://zeropointprotocol.ai/api/healthz -o healthz.json
          jq -e 'type=="object"' healthz.json >/dev/null
          curl -sS -D - https://zeropointprotocol.ai/api/readyz -o readyz.json
          jq -e 'type=="object"' readyz.json >/dev/null
          curl -sS -D - https://zeropointprotocol.ai/robots.txt | head -n1 | grep -qi '200'
          curl -sS -D - https://zeropointprotocol.ai/sitemap.xml | head -n1 | grep -qi '200'

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: production-verification
          path: evidence/prod
