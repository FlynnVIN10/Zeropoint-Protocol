global
    daemon
    maxconn 4096
    log stdout format raw local0 info
    user haproxy
    group haproxy

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global
    option tcplog
    option dontlognull
    retries 3

# PostgreSQL Load Balancer
listen postgres_cluster
    bind *:5434
    mode tcp
    balance roundrobin
    option tcp-check
    tcp-check connect
    tcp-check send-binary 00000000
    tcp-check expect binary 4e
    server postgres_primary postgres-primary:5432 check inter 2000 rise 2 fall 3
    server postgres_replica postgres-replica-1:5432 check inter 2000 rise 2 fall 3 backup

# Redis Load Balancer
listen redis_cluster
    bind *:6381
    mode tcp
    balance roundrobin
    option tcp-check
    tcp-check connect
    tcp-check send-binary 2a310d0a
    tcp-check expect binary 2b504f4e470d0a
    server redis_primary redis-primary:6379 check inter 2000 rise 2 fall 3
    server redis_replica redis-replica-1:6379 check inter 2000 rise 2 fall 3 backup

# HAProxy Stats
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats show-legends
    stats auth admin:admin123
